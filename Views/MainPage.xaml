<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:MoodMixer.ViewModels"
             xmlns:models="clr-namespace:MoodMixer.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="MoodMixer.Views.MainPage"
             x:DataType="viewModels:MainViewModel"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="ColorPreviewStyle" TargetType="Border">
                <Setter Property="HeightRequest" Value="80" />
                <Setter Property="WidthRequest" Value="80" />
                <Setter Property="StrokeShape" Value="RoundRectangle 10" />
                <Setter Property="Stroke" Value="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Margin" Value="5" />
                <Setter Property="HorizontalOptions" Value="Center" />
            </Style>
            
            <Style x:Key="ColorLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="Margin" Value="0,5,0,10" />
            </Style>
            
            <Style x:Key="ButtonStyle" TargetType="Button">
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="Padding" Value="15,10" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>
            
            <Style x:Key="SavedThemeStyle" TargetType="Border">
                <Setter Property="HeightRequest" Value="60" />
                <Setter Property="StrokeShape" Value="RoundRectangle 8" />
                <Setter Property="Stroke" Value="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Margin" Value="0,5" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid ColumnDefinitions="*,*,*"
          RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,*"
          Padding="20"
          RowSpacing="10">
        
        <!-- App Title -->
        <Label Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
               Text="MoodMixer" 
               FontSize="32" 
               FontAttributes="Bold" 
               HorizontalOptions="Center"
               Margin="0,0,0,5" />
        
        <!-- App Description -->
        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
               Text="Create and save color themes that match your mood!"
               FontSize="16"
               HorizontalOptions="Center"
               Margin="0,0,0,15" />
        
        <!-- Color Preview Boxes -->
        <Border Grid.Row="2" Grid.Column="0"
                BackgroundColor="{Binding PrimaryColor}"
                Style="{StaticResource ColorPreviewStyle}">
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding RandomizeColorsCommand}" />
            </Border.GestureRecognizers>
        </Border>
        
        <Border Grid.Row="2" Grid.Column="1"
                BackgroundColor="{Binding SecondaryColor}"
                Style="{StaticResource ColorPreviewStyle}">
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding RandomizeColorsCommand}" />
            </Border.GestureRecognizers>
        </Border>
        
        <Border Grid.Row="2" Grid.Column="2"
                BackgroundColor="{Binding AccentColor}"
                Style="{StaticResource ColorPreviewStyle}">
            <Border.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding RandomizeColorsCommand}" />
            </Border.GestureRecognizers>
        </Border>
        
        <!-- Color Labels -->
        <Label Grid.Row="3" Grid.Column="0" 
               Text="Primary" 
               Style="{StaticResource ColorLabelStyle}" />
        
        <Label Grid.Row="3" Grid.Column="1" 
               Text="Secondary" 
               Style="{StaticResource ColorLabelStyle}" />
        
        <Label Grid.Row="3" Grid.Column="2" 
               Text="Accent" 
               Style="{StaticResource ColorLabelStyle}" />
        
        <!-- Randomize Button -->
        <Button Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3"
                Text="Randomize Colors"
                Command="{Binding RandomizeColorsCommand}"
                Style="{StaticResource ButtonStyle}"
                BackgroundColor="{Binding AccentColor}"
                TextColor="White"
                Margin="0,5,0,15" />
        
        <!-- Theme Name Label -->
        <Label Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3"
               Text="Theme Name" 
               FontSize="16" 
               FontAttributes="Bold" />
        
        <!-- Theme Name Entry -->
        <Entry Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
               Text="{Binding ThemeName}" 
               Placeholder="Enter a name for your theme"
               ClearButtonVisibility="WhileEditing" />
        
        <!-- Save Theme Button -->
        <Button Grid.Row="6" Grid.Column="2"
                Text="Save Theme"
                Command="{Binding SaveThemeCommand}"
                IsEnabled="{Binding IsSaving, Converter={toolkit:InvertedBoolConverter}}"
                Style="{StaticResource ButtonStyle}"
                BackgroundColor="{Binding PrimaryColor}"
                TextColor="White"
                Margin="10,0,0,0" />
        
        <!-- Status Message -->
        <Label Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="3"
               Text="{Binding StatusMessage}" 
               FontSize="14" 
               HorizontalOptions="Center"
               IsVisible="{Binding StatusMessage, Converter={toolkit:IsListNotNullOrEmptyConverter}}" />
        
        <!-- Saved Themes Label -->
        <Label Grid.Row="8" Grid.Column="0" Grid.ColumnSpan="3"
               Text="Saved Themes" 
               FontSize="20" 
               FontAttributes="Bold"
               Margin="0,10,0,0" />
        
        <!-- Separator Line -->
        <BoxView Grid.Row="9" Grid.Column="0" Grid.ColumnSpan="3"
                 HeightRequest="1"
                 Color="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                 Margin="0,5" />
        
        <!-- Saved Themes Collection -->
        <CollectionView Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="3"
                        ItemsSource="{Binding SavedThemes}"
                        EmptyView="No themes saved yet. Create your first theme above!">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:ColorTheme">
                    <Border Style="{StaticResource SavedThemeStyle}">
                        <Grid ColumnDefinitions="30,30,30,*,Auto,Auto" Padding="10,5">
                            <!-- Color Swatches -->
                            <Rectangle Grid.Column="0" Fill="{Binding PrimaryColor}" HeightRequest="30" />
                            <Rectangle Grid.Column="1" Fill="{Binding SecondaryColor}" HeightRequest="30" />
                            <Rectangle Grid.Column="2" Fill="{Binding AccentColor}" HeightRequest="30" />
                            
                            <!-- Theme Info -->
                            <StackLayout Grid.Column="3" Orientation="Vertical" VerticalOptions="Center" Margin="10,0">
                                <Label Text="{Binding Name}" FontSize="16" FontAttributes="Bold" />
                                <Label Text="{Binding CreatedAt, StringFormat='{0:MMM dd, yyyy}'}" FontSize="12" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                            </StackLayout>
                            
                            <!-- Apply Button -->
                            <Button Grid.Column="4"
                                    Text="Apply"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MainViewModel}}, Path=ApplyThemeCommand}"
                                    CommandParameter="{Binding .}"
                                    Style="{StaticResource ButtonStyle}"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                    TextColor="White"
                                    Margin="5,0" />
                            
                            <!-- Delete Button -->
                            <Button Grid.Column="5"
                                    Text="Delete"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MainViewModel}}, Path=DeleteThemeCommand}"
                                    CommandParameter="{Binding .}"
                                    Style="{StaticResource ButtonStyle}"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                                    TextColor="White" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>
